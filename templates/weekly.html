{% extends "base.html" %} {% block title %}Weekly Report - Compliance
Monitoring{% endblock %} {% block extra_styles %}
<style>
  .chart-container {
    margin: 2rem 0;
    padding: 1rem;
    background: white;
    border-radius: 8px;
  }
</style>
{% endblock %} {% block content %}
<h2 style="margin-bottom: 1.5rem">üìÖ Weekly Compliance Report</h2>
<p style="font-size: 1.1rem; color: #6c757d; margin-bottom: 2rem">
  Data from {{ start_date.strftime('%B %d, %Y') }} to {{ end_date.strftime('%B
  %d, %Y') }}
</p>

<!-- Charts Section -->
<div class="card">
  <h2>üìä Weekly Trends</h2>

  <!-- Windows Update Chart -->
  <div class="chart-container">
    <h3 style="margin-bottom: 1rem">Windows Update Non-Compliance Trend</h3>
    <canvas id="windows-chart"></canvas>
  </div>

  <!-- Antivirus Chart -->
  <div class="chart-container">
    <h3 style="margin-bottom: 1rem">Antivirus Non-Compliance Trend</h3>
    <canvas id="antivirus-chart"></canvas>
  </div>

  <!-- Mobile Encryption Chart -->
  <div class="chart-container">
    <h3 style="margin-bottom: 1rem">Mobile Encryption Non-Compliance Trend</h3>
    <canvas id="mobile-chart"></canvas>
  </div>
</div>

<!-- Windows Update Weekly Data -->
<div class="card">
  <h2>ü™ü Windows Update - Weekly Data ({{ weekly|length }} records)</h2>
  {% if weekly %}
  <table id="windows-monthly-table">
    <thead>
      <tr>
        <th>Date</th>
        <th>Hostname</th>
        <th>Username</th>
        <th>IP Address</th>
        <th>Local</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody>
      {% for device in weekly %}
      <tr>
        <td id="windows-date-{{ device.id }}">
          {{ device.recorded_date.strftime('%Y-%m-%d') }}
        </td>
        <td id="windows-device-{{ device.id }}">{{ device.hostname }}</td>
        <td id="windows-username-{{ device.id }}">{{ device.username }}</td>
        <td id="windows-ip-{{ device.id }}">{{ device.ip_address }}</td>
        <td id="windows-local-{{ device.id }}">{{ device.local }}</td>
        <td>
          <span class="status-badge status-non-compliant"
            >{{ device.status }}</span
          >
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <div class="empty-state">
    <p>No Windows Update data for this week</p>
  </div>
  {% endif %}
</div>

<!-- Antivirus Monthly Data -->
<div class="card">
  <h2>üõ°Ô∏è Antivirus - Weekly Data ({{ antivirus_weekly|length }} records)</h2>
  {% if antivirus_weekly %}
  <table id="antivirus-weekly-table">
    <thead>
      <tr>
        <th>Date</th>
        <th>Hostname</th>
        <th>User name</th>
        <th>IP Address</th>
        <th>Local</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody>
      {% for device in antivirus_weekly %}
      <tr>
        <td id="antivirus-date-{{ device.id }}">
          {{ device.recorded_date.strftime('%Y-%m-%d') }}
        </td>
        <td id="antivirus-device-{{ device.id }}">{{ device.hostname }}</td>
        <td id="antivirus-username-{{ device.id }}">{{ device.username }}</td>
        <td id="antivirus-ip-{{ device.id }}">{{ device.ip_address }}</td>
        <td id="antivirus-local-{{ device.id }}">{{ device.local}}</td>
        <td>
          <span class="status-badge status-non-compliant"
            >{{ device.status }}</span
          >
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <div class="empty-state">
    <p>No Antivirus data for this week</p>
  </div>
  {% endif %}
</div>

<!-- Mobile Encryption Monthly Data -->
<div class="card">
  <h2>
    üì± Mobile Encryption - Weekly Data ({{ mobile_weekly|length }} records)
  </h2>
  {% if mobile_weekly %}
  <table id="mobile-weekly-table">
    <thead>
      <tr>
        <th>Date</th>
        <th>Hostname</th>
        <th>Hostname</th>
        <th>IP Address</th>
        <th>Local</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody>
      {% for device in mobile_weekly %}
      <tr>
        <td id="mobile-date-{{ device.id }}">
          {{ device.recorded_date.strftime('%Y-%m-%d') }}
        </td>
        <td id="mobile-device-{{ device.id }}">{{ device.hostname }}</td>
        <td id="mobile-username-{{ device.id }}">{{ device.username }}</td>
        <td id="mobile-ip-{{ device.id }}">{{ device.ip_address }}</td>
        <td id="mobile-local-{{ device.id }}">{{ device.local }}</td>
        <td>
          <span class="status-badge status-non-compliant"
            >{{ device.status }}</span
          >
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <div class="empty-state">
    <p>No Mobile Encryption data for this week</p>
  </div>
  {% endif %}
</div>
{% endblock %} {% block extra_scripts %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
<script>
  // Prepare data for Windows Update chart
  const windowsData = {{ windows_chart|tojson }};
  const windowsDates = windowsData.map(item => item[0]);
  const windowsCounts = windowsData.map(item => item[1]);

  // Windows Update Chart
  new Chart(document.getElementById('windows-chart'), {
      type: 'line',
      data: {
          labels: windowsDates,
          datasets: [{
              label: 'Non-Compliant Devices',
              data: windowsCounts,
              borderColor: '#e74c3c',
              backgroundColor: 'rgba(231, 76, 60, 0.1)',
              tension: 0.4,
              fill: true
          }]
      },
      options: {
          responsive: true,
          plugins: {
              legend: { display: true }
          },
          scales: {
              y: { beginAtZero: true }
          }
      }
  });

  // Prepare data for Antivirus chart
  const antivirusData = {{ antivirus_chart|tojson }};
  const antivirusDates = antivirusData.map(item => item[0]);
  const antivirusCounts = antivirusData.map(item => item[1]);

  // Antivirus Chart
  new Chart(document.getElementById('antivirus-chart'), {
      type: 'bar',
      data: {
          labels: antivirusDates,
          datasets: [{
              label: 'Non-Compliant Devices',
              data: antivirusCounts,
              backgroundColor: '#f39c12',
              borderColor: '#e67e22',
              borderWidth: 1
          }]
      },
      options: {
          responsive: true,
          plugins: {
              legend: { display: true }
          },
          scales: {
              y: { beginAtZero: true }
          }
      }
  });

  // Prepare data for Mobile Encryption chart
  const mobileData = {{ mobile_chart|tojson }};
  const mobileDates = mobileData.map(item => item[0]);
  const mobileCounts = mobileData.map(item => item[1]);

  // Mobile Encryption Chart
  new Chart(document.getElementById('mobile-chart'), {
      type: 'line',
      data: {
          labels: mobileDates,
          datasets: [{
              label: 'Non-Compliant Devices',
              data: mobileCounts,
              borderColor: '#9b59b6',
              backgroundColor: 'rgba(155, 89, 182, 0.1)',
              tension: 0.4,
              fill: true
          }]
      },
      options: {
          responsive: true,
          plugins: {
              legend: { display: true }
          },
          scales: {
              y: { beginAtZero: true }
          }
      }
  });
</script>
{% endblock %}
